import{m as A,i as C,a as R,t as x,g as I}from"./market-gw47CPyf.js";import{d as O,g as f,p as y,c as i,a as t,j as g,t as l,m as T,e as _,o as c,_ as q,q as E,F as $,k as D,f as F}from"./index-Cadst9Cf.js";const j={class:"api-status"},L={class:"status-text"},M={key:0,class:"last-request"},N={key:1,class:"stats"},V={class:"stat-item"},B={class:"stat-value"},H={class:"stat-item"},z={class:"stat-value success"},K={class:"stat-item"},U={class:"stat-value error"},G={class:"stat-item"},J={class:"stat-value"},Q=O({__name:"ApiStatus",setup(P,{expose:d}){const u=f("idle"),o=f(null),m=f([]),r=y(()=>{switch(u.value){case"idle":return"空闲";case"loading":return"请求中";case"success":return"成功";case"error":return"错误";default:return"未知"}}),n=y(()=>{const v=m.value.length,e=m.value.filter(a=>a.success).length,s=v-e;return{total:v,success:e,failed:s}}),k=y(()=>n.value.total===0?0:Math.round(n.value.success/n.value.total*100)),w=v=>new Date(v).toLocaleTimeString();return d({recordRequest:(v,e)=>{const s={time:Date.now(),duration:v,success:e};m.value.push(s),o.value=s,m.value.length>10&&(m.value=m.value.slice(-10))},setStatus:v=>{u.value=v}}),(v,e)=>(c(),i("div",j,[t("div",{class:T(["status-indicator",u.value])},[e[0]||(e[0]=t("div",{class:"indicator-dot"},null,-1)),t("span",L,l(r.value),1)],2),o.value?(c(),i("div",M,[t("p",null,[e[1]||(e[1]=t("strong",null,"最后请求:",-1)),_(" "+l(w(o.value.time)),1)]),t("p",null,[e[2]||(e[2]=t("strong",null,"响应时间:",-1)),_(" "+l(o.value.duration)+"ms",1)]),t("p",null,[e[3]||(e[3]=t("strong",null,"状态:",-1)),_(" "+l(o.value.success?"成功":"失败"),1)])])):g("",!0),n.value?(c(),i("div",N,[t("div",V,[e[4]||(e[4]=t("span",{class:"stat-label"},"总请求",-1)),t("span",B,l(n.value.total),1)]),t("div",H,[e[5]||(e[5]=t("span",{class:"stat-label"},"成功",-1)),t("span",z,l(n.value.success),1)]),t("div",K,[e[6]||(e[6]=t("span",{class:"stat-label"},"失败",-1)),t("span",U,l(n.value.failed),1)]),t("div",G,[e[7]||(e[7]=t("span",{class:"stat-label"},"成功率",-1)),t("span",J,l(k.value)+"%",1)])])):g("",!0)]))}}),W=q(Q,[["__scopeId","data-v-e3851fb7"]]),X={class:"api-test"},Y={class:"test-section"},Z={class:"test-controls"},ss=["disabled"],ts=["disabled"],es=["disabled"],as={class:"test-results"},ls={key:0,class:"loading"},os={key:1,class:"error"},ns={key:2,class:"success"},rs={class:"result-info"},us={class:"sample-data"},is={class:"item-details"},cs={class:"sell-info"},ds={key:0},vs={key:1},ps={class:"buy-info"},ms={key:0},fs={key:1},_s={class:"test-section"},gs={class:"log-container"},ys={class:"log-time"},ks={class:"log-message"},ws=O({__name:"ApiTest",setup(P){const d=f(!1),u=f(""),o=f(null),m=f([]),r=f(),n=(e,s="info")=>{m.value.unshift({time:new Date().toLocaleTimeString(),message:e,type:s})},k=e=>e?new Date(e).toLocaleString():"未知",w=async()=>{d.value=!0,u.value="",o.value=null,r.value?.setStatus("loading"),n("开始测试市场价格API...","info");const e=Date.now();try{const s=await A.getMarketPrice();o.value=s;const a=Date.now()-e;r.value?.recordRequest(a,!0),r.value?.setStatus("success"),n("API请求成功","success")}catch(s){u.value=s instanceof Error?s.message:"未知错误",C(s)&&(u.value=R(s),n("检测到CORS错误，建议使用代理或联系服务器管理员","error"));const a=Date.now()-e;r.value?.recordRequest(a,!1),r.value?.setStatus("error"),n(`API请求失败: ${u.value}`,"error")}finally{d.value=!1}},S=async()=>{d.value=!0,u.value="",o.value=null,r.value?.setStatus("loading"),n("开始测试直接Fetch请求...","info");const e=Date.now();try{const s=await fetch("https://www.moyu-idle.com/api/game/market/price");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();o.value=a;const p=Date.now()-e;r.value?.recordRequest(p,!0),r.value?.setStatus("success"),n("Fetch请求成功","success")}catch(s){u.value=s instanceof Error?s.message:"未知错误",C(s)&&(u.value=R(s),n("检测到CORS错误，建议使用代理或联系服务器管理员","error"));const a=Date.now()-e;r.value?.recordRequest(a,!1),r.value?.setStatus("error"),n(`Fetch请求失败: ${u.value}`,"error")}finally{d.value=!1}},h=async()=>{d.value=!0,u.value="",o.value=null,r.value?.setStatus("loading"),n("开始测试CORS修复方法...","info");const e=Date.now();try{const s=await x("/api/game/market/price");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();o.value=a;const p=Date.now()-e;r.value?.recordRequest(p,!0),r.value?.setStatus("success"),n("CORS修复请求成功","success")}catch(s){u.value=s instanceof Error?s.message:"未知错误";const a=Date.now()-e;r.value?.recordRequest(a,!1),r.value?.setStatus("error"),n(`CORS修复请求失败: ${u.value}`,"error")}finally{d.value=!1}},v=y(()=>{if(!o.value?.data?.items)return{};const e=o.value.data.items,a=Object.keys(e).slice(0,5),p={};return a.forEach(b=>{p[b]=e[b]}),p});return(e,s)=>(c(),i("div",X,[s[12]||(s[12]=t("h1",null,"API 测试页面",-1)),E(W,{ref_key:"apiStatusRef",ref:r},null,512),t("div",Y,[s[10]||(s[10]=t("h2",null,"市场价格API测试",-1)),t("div",Z,[t("button",{onClick:w,disabled:d.value},l(d.value?"请求中...":"测试市场价格API"),9,ss),t("button",{onClick:S,disabled:d.value}," 测试直接Fetch ",8,ts),t("button",{onClick:h,disabled:d.value}," 测试CORS修复 ",8,es)]),t("div",as,[d.value?(c(),i("div",ls,s[0]||(s[0]=[t("div",{class:"spinner"},null,-1),t("p",null,"请求中...",-1)]))):g("",!0),u.value?(c(),i("div",os,[s[1]||(s[1]=t("h3",null,"错误信息",-1)),t("pre",null,l(u.value),1)])):g("",!0),o.value?(c(),i("div",ns,[s[9]||(s[9]=t("h3",null,"请求成功",-1)),t("div",rs,[t("p",null,[s[2]||(s[2]=t("strong",null,"状态码:",-1)),_(" "+l(o.value.code),1)]),t("p",null,[s[3]||(s[3]=t("strong",null,"消息:",-1)),_(" "+l(o.value.msg),1)]),t("p",null,[s[4]||(s[4]=t("strong",null,"商品数量:",-1)),_(" "+l(Object.keys(o.value.data?.items||{}).length),1)]),t("p",null,[s[5]||(s[5]=t("strong",null,"最后更新时间:",-1)),_(" "+l(k(o.value.data?.lastUpdateTime)),1)])]),t("div",us,[s[8]||(s[8]=t("h4",null,"示例数据 (前5个商品)",-1)),(c(!0),i($,null,D(v.value,(a,p)=>(c(),i("div",{key:p,class:"item"},[t("h5",null,l(F(I)(p)),1),t("div",is,[t("div",cs,[s[6]||(s[6]=t("strong",null,"出售信息:",-1)),a.sellOrders?(c(),i("span",ds," 最低价: "+l(a.sellOrders.minPrice)+", 数量: "+l(a.sellOrders.minPriceCount)+", 订单数: "+l(a.sellOrders.orderCount),1)):(c(),i("span",vs,"无出售订单"))]),t("div",ps,[s[7]||(s[7]=t("strong",null,"求购信息:",-1)),a.buyOrders?(c(),i("span",ms," 最高价: "+l(a.buyOrders.maxPrice)+", 数量: "+l(a.buyOrders.maxPriceCount)+", 订单数: "+l(a.buyOrders.orderCount),1)):(c(),i("span",fs,"无求购订单"))])])]))),128))])])):g("",!0)])]),t("div",_s,[s[11]||(s[11]=t("h2",null,"请求日志",-1)),t("div",gs,[(c(!0),i($,null,D(m.value,(a,p)=>(c(),i("div",{key:p,class:T(["log-item",a.type])},[t("span",ys,l(a.time),1),t("span",ks,l(a.message),1)],2))),128))])])]))}}),bs=q(ws,[["__scopeId","data-v-825d4b53"]]);export{bs as default};

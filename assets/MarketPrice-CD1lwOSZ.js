import{d as U,g as i,p as M,h as R,i as V,c as u,a as e,j as b,t as a,w as $,v as F,F as K,k as X,n as L,u as Y,f as q,o as d,_ as G}from"./index-B94m1PT7.js";import{i as T}from"./index-Bb6yjXMn.js";import{m as N}from"./mockData-CMSpithW.js";import{g as k,m as H}from"./market-CW_V7YUN.js";const J={class:"market-price"},Q={class:"header-left"},W={key:0,class:"update-time"},Z={class:"header-right"},ee={class:"search-box"},te={key:0,class:"loading"},le={key:1,class:"error"},se={key:2,class:"market-content"},ae={class:"market-stats"},re={class:"stat-card"},ne={class:"stat-card"},oe={class:"stat-card"},ie={class:"stat-card"},ue={class:"charts-container"},de={class:"chart-wrapper"},ce={class:"chart-wrapper"},ve={class:"market-table"},me={class:"table-container"},pe=U({__name:"MarketPrice",setup(fe){const c=i({}),n=i({}),O=i(!1),_=i(""),f=i(0),v=i(""),h=i(),g=i(),C=i();let m=null,p=null;const w=M(()=>Object.values(n.value).filter(l=>l.sellOrders!==null).length),x=M(()=>Object.values(n.value).filter(l=>l.buyOrders!==null).length),S=l=>l.toLocaleString(),j=()=>{if(!v.value.trim())n.value={...c.value};else{const l={};Object.entries(c.value).forEach(([t,s])=>{const o=k(s.itemId).toLowerCase(),r=v.value.toLowerCase();(o.includes(r)||s.itemId.toLowerCase().includes(r))&&(l[t]=s)}),n.value=l}L(()=>{I()})},A=()=>{v.value="",j()},z=Y(),B=()=>{z.push("/market-analysis")},P=async()=>{O.value=!0,_.value="";try{const l=await H.getMarketPrice();if(l.code===200&&l.data.items)c.value=l.data.items,n.value={...l.data.items},f.value=l.data.lastUpdateTime;else throw new Error("API返回数据格式错误");L(()=>{I()})}catch(l){console.log("API请求失败，使用模拟数据:",l),c.value=N,n.value={...N},f.value=Date.now(),L(()=>{I()})}finally{O.value=!1}},I=()=>{if(Object.keys(n.value).length!==0){if(g.value){m&&m.dispose(),m=T(g.value);const t=Object.entries(n.value).filter(([o,r])=>r.sellOrders?.minPrice&&r.sellOrders.minPrice>0||r.buyOrders?.maxPrice&&r.buyOrders.maxPrice>0),s={title:{text:"价格分布",left:"center"},tooltip:{trigger:"axis",formatter:function(o){const r=t[o[0].dataIndex]?.[0]||"";let E=`${k(r)}<br/>`;return o.forEach(y=>{y.value!==null&&y.value!==void 0&&(E+=`${y.seriesName}: ${y.value}<br/>`)}),E}},legend:{data:["出售价格","求购价格"],top:30},xAxis:{type:"category",data:t.map(([o,r])=>k(o)),axisLabel:{rotate:45,fontSize:10}},yAxis:{type:"value",name:"价格"},series:[{name:"出售价格",type:"bar",data:t.map(([o,r])=>r.sellOrders?.minPrice||null),itemStyle:{color:"#ff6b6b"}},{name:"求购价格",type:"bar",data:t.map(([o,r])=>r.buyOrders?.maxPrice||null),itemStyle:{color:"#4ecdc4"}}]};m.setOption(s)}if(C.value){p&&p.dispose(),p=T(C.value);const t=Object.keys(n.value).length-w.value-x.value,s={title:{text:"订单数量分布",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",top:30},series:[{name:"订单数量",type:"pie",radius:"50%",data:[{value:w.value,name:"有出售订单",itemStyle:{color:"#ff6b6b"}},{value:x.value,name:"有求购订单",itemStyle:{color:"#4ecdc4"}},{value:t,name:"无订单",itemStyle:{color:"#95a5a6"}}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};p.setOption(s)}}};R(()=>{P(),window.addEventListener("resize",()=>{m?.resize(),p?.resize()}),window.addEventListener("scroll",D)}),V(()=>{window.removeEventListener("scroll",D)});const D=()=>{h.value&&((window.pageYOffset||document.documentElement.scrollTop)>100?h.value.classList.add("sticky"):h.value.classList.remove("sticky"))};return(l,t)=>(d(),u("div",J,[e("div",{class:"header",ref_key:"headerRef",ref:h},[e("div",Q,[t[1]||(t[1]=e("h1",null,"市场价格",-1)),f.value?(d(),u("p",W," 最后更新: "+a(new Date(f.value).toLocaleString()),1)):b("",!0)]),e("div",Z,[e("div",ee,[$(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),onInput:j,placeholder:"搜索商品名称...",class:"search-input"},null,544),[[F,v.value]]),e("button",{onClick:A,class:"clear-btn"},"清除")]),e("div",{class:"refresh-btn",onClick:P},t[2]||(t[2]=[e("span",null,"刷新数据",-1)])),e("div",{class:"analysis-btn",onClick:B},t[3]||(t[3]=[e("span",null,"智能分析",-1)]))])],512),O.value?(d(),u("div",te,t[4]||(t[4]=[e("div",{class:"spinner"},null,-1),e("p",null,"加载中...",-1)]))):b("",!0),_.value?(d(),u("div",le,[e("p",null,a(_.value),1),e("button",{onClick:P},"重试")])):b("",!0),Object.keys(n.value).length>0?(d(),u("div",se,[e("div",ae,[e("div",re,[t[5]||(t[5]=e("h3",null,"商品总数",-1)),e("p",null,a(Object.keys(c.value).length),1)]),e("div",ne,[t[6]||(t[6]=e("h3",null,"筛选结果",-1)),e("p",null,a(Object.keys(n.value).length),1)]),e("div",oe,[t[7]||(t[7]=e("h3",null,"有出售订单",-1)),e("p",null,a(w.value),1)]),e("div",ie,[t[8]||(t[8]=e("h3",null,"有求购订单",-1)),e("p",null,a(x.value),1)])]),e("div",ue,[e("div",de,[t[9]||(t[9]=e("h3",null,"价格分布",-1)),e("div",{ref_key:"priceChart",ref:g,class:"chart"},null,512)]),e("div",ce,[t[10]||(t[10]=e("h3",null,"订单数量分布",-1)),e("div",{ref_key:"orderChart",ref:C,class:"chart"},null,512)])]),e("div",ve,[t[12]||(t[12]=e("h3",null,"商品详情",-1)),e("div",me,[e("table",null,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"商品名称"),e("th",null,"最低出售价"),e("th",null,"最低出售数量"),e("th",null,"总出售数量"),e("th",null,"出售订单数"),e("th",null,"最高求购价"),e("th",null,"最高求购数量"),e("th",null,"总求购数量"),e("th",null,"求购订单数")])],-1)),e("tbody",null,[(d(!0),u(K,null,X(n.value,(s,o)=>(d(),u("tr",{key:o},[e("td",null,a(q(k)(s.itemId)),1),e("td",null,a(S(s.sellOrders?.minPrice||0)),1),e("td",null,a(s.sellOrders?.minPriceCount||0),1),e("td",null,a(s.sellOrders?.totalCount||0),1),e("td",null,a(s.sellOrders?.orderCount||0),1),e("td",null,a(S(s.buyOrders?.maxPrice||0)),1),e("td",null,a(s.buyOrders?.maxPriceCount||0),1),e("td",null,a(s.buyOrders?.totalCount||0),1),e("td",null,a(s.buyOrders?.orderCount||0),1)]))),128))])])])])])):b("",!0)]))}}),_e=G(pe,[["__scopeId","data-v-3da18373"]]);export{_e as default};
